<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Yet Another Todo List (YATL) - Part 2 | COM1028 LAB 5 and 6</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/com-1028-labs/assets/css/0.styles.ca6a016f.css" as="style"><link rel="preload" href="/com-1028-labs/assets/js/app.13e044df.js" as="script"><link rel="preload" href="/com-1028-labs/assets/js/2.b1f9b7d9.js" as="script"><link rel="preload" href="/com-1028-labs/assets/js/1.044c1f98.js" as="script"><link rel="preload" href="/com-1028-labs/assets/js/17.bebc8070.js" as="script"><link rel="prefetch" href="/com-1028-labs/assets/js/10.fd629be3.js"><link rel="prefetch" href="/com-1028-labs/assets/js/11.627f1037.js"><link rel="prefetch" href="/com-1028-labs/assets/js/12.56fca55f.js"><link rel="prefetch" href="/com-1028-labs/assets/js/13.41172a41.js"><link rel="prefetch" href="/com-1028-labs/assets/js/14.0dc851ca.js"><link rel="prefetch" href="/com-1028-labs/assets/js/15.845454d7.js"><link rel="prefetch" href="/com-1028-labs/assets/js/16.3637d4f7.js"><link rel="prefetch" href="/com-1028-labs/assets/js/18.a669e692.js"><link rel="prefetch" href="/com-1028-labs/assets/js/19.34204f89.js"><link rel="prefetch" href="/com-1028-labs/assets/js/20.24f07836.js"><link rel="prefetch" href="/com-1028-labs/assets/js/21.7f8f7869.js"><link rel="prefetch" href="/com-1028-labs/assets/js/22.0a557d47.js"><link rel="prefetch" href="/com-1028-labs/assets/js/23.a4908e7f.js"><link rel="prefetch" href="/com-1028-labs/assets/js/3.64ae4e2d.js"><link rel="prefetch" href="/com-1028-labs/assets/js/4.0164d426.js"><link rel="prefetch" href="/com-1028-labs/assets/js/5.8509ff60.js"><link rel="prefetch" href="/com-1028-labs/assets/js/6.725e7bf5.js"><link rel="prefetch" href="/com-1028-labs/assets/js/7.6acff8ff.js"><link rel="prefetch" href="/com-1028-labs/assets/js/vendors~docsearch.ebc307dd.js">
    <link rel="stylesheet" href="/com-1028-labs/assets/css/0.styles.ca6a016f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/com-1028-labs/" class="home-link router-link-active"><!----> <span class="site-name">COM1028 LAB 5 and 6</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/com-1028-labs/" class="nav-link">
  Part 1 (Lab 5)
</a></div><div class="nav-item"><a href="/com-1028-labs/part-2.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Part 2 (Lab 6)
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/com-1028-labs/" class="nav-link">
  Part 1 (Lab 5)
</a></div><div class="nav-item"><a href="/com-1028-labs/part-2.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Part 2 (Lab 6)
</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="yet-another-todo-list-yatl-part-2"><a href="#yet-another-todo-list-yatl-part-2" class="header-anchor">#</a> Yet Another Todo List (YATL) - Part 2</h1> <p><img src="/com-1028-labs/assets/img/header.2a488027.png" alt="Todo List"></p> <p>This is the second part of our two part lab series on building the API for YATL. In this part, we will consider how we can write a comprehensive set of tests for our API.</p> <h2 id="learning-objectives"><a href="#learning-objectives" class="header-anchor">#</a> Learning Objectives</h2> <ul><li>Understanding how to write unit, feature, and systems tests.</li> <li>Working with the Junit and RestAssured libraries.</li> <li>Understanding how to mock using Mockito.</li></ul> <h2 id="exercise-1-setting-up-the-project"><a href="#exercise-1-setting-up-the-project" class="header-anchor">#</a> Exercise 1: Setting up the Project</h2> <p>In this section, you will grab the starter code and install some dependencies to support you in testing it.</p> <h3 id="exercise-1-1-cloning-the-repository"><a href="#exercise-1-1-cloning-the-repository" class="header-anchor">#</a> Exercise 1.1: Cloning the Repository</h3> <ol><li><p>Open a terminal window.</p></li> <li><p>Navigate to the directory where you want the project to be located.</p></li> <li><p>Run the following command to clone the repository:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>	<span class="token function">git</span> clone https://gitlab.surrey.ac.uk/com_1028_labs/lab-6.git
</code></pre></div></li></ol> <p>The above command will clone the repository into a directory called <code>lab-6</code>.</p> <ol start="4"><li>Open Eclipse (There are two versions on the lab machines. Open the latest version, 2023 to 06)</li></ol> <p><img src="/com-1028-labs/assets/img/eclipse-2023-06.4d925354.png" alt=""></p> <ol start="5"><li><p>Import the project folder into your Eclipse Workspace: <code>File -&gt; Open Projects from File System -&gt; Directory</code></p></li> <li><p>We need to ensure we are using Java 17, or higher. In your package explorer in the root of your project, you should see a file called <code>JRE System Library</code>. Right click on this and select <code>Properties</code>. In the <code>Execution Environment</code> section, select <code>JavaSE-17</code> and click <code>Apply and Close</code>.</p></li></ol> <p><img src="/com-1028-labs/assets/img/set-jre.6049ae3f.png" alt="Java 17"></p> <p><img src="data:image/png;base64,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" alt="Java 17"></p> <ol start="6"><li><p>At this stage, you should be able to run the project. Right click on <code>src/main/java/com/yatl/Main.java</code> and select <code>Run As -&gt; Java Application</code>. In the console, you may see some warnings regarding a logger not being set up, ignore this</p></li> <li><p>To test your application is work open Firefox and navigate to <code>http://localhost:8000/todos</code>. You should see a JSON response with an empty array.</p></li></ol> <p><strong>TIP: Ensure you use Firefox or Chrome with a JSON extension installed. Otherwise, the API output will be hard to read</strong></p> <ol start="8"><li><p>Explore the further functionality of the API by using the following endpoints:</p> <ul><li><code>http://localhost:8000/todos</code></li> <li><code>http://localhost:8000/todos/1</code></li> <li><code>http://localhost:8000/todos/?status=completed</code></li> <li><code>http://localhost:8000/todos/?status=active</code></li></ul></li></ol> <p>JSON is a format for storing and transporting data. A front end developer would use this data to display the information to the user. For example, a front end developer could use the data from the <code>/todos</code> endpoint to display a list of todos to the user. <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON" target="_blank" rel="noopener noreferrer">You can read more about JSON here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="exercise-1-2-installing-dependencies"><a href="#exercise-1-2-installing-dependencies" class="header-anchor">#</a> Exercise 1.2: Installing Dependencies</h3> <p>In order to test the YATL application, we are going to need to install three testing libraries:</p> <ul><li>junit - JUnit for unit testing</li> <li>mockito - Mockito for mocking objects in unit tests</li> <li>rest-assured - Testing and validating our APIs</li></ul> <ol><li><p>See if you can find the above dependencies on the <a href="https://mvnrepository.com/" target="_blank" rel="noopener noreferrer">Maven Repository<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. When you have found them, add them to the dependencies section of the <code>pom.xml</code> file. You should install the latests versions of the dependencies. At the time of writing, these are:</p> <ul><li>junit: 5.10.2</li> <li>mockito-core: 5.11.0</li> <li>rest-assured: 5.4.0</li></ul></li></ol> <p><a href="https://gitlab.surrey.ac.uk/com_1028_labs/lab-6/-/blob/exercise-1-solutions/pom.xml?ref_type=heads" target="_blank" rel="noopener noreferrer">Check your POM.xml file against the solutions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="exercise-1-3-setting-up-the-test-directory"><a href="#exercise-1-3-setting-up-the-test-directory" class="header-anchor">#</a> Exercise 1.3: Setting up the Test Directory</h3> <p>We are now ready to create some packages for our tests to go in. These packages should be created in the <code>src/test/java</code> directory. They should mirror the packages in the <code>src/main/java</code> directory.</p> <ol><li>To match the <code>src/main/java</code> directory, right click on the <code>src/test/java</code> directory and create the following packages:</li></ol> <ul><li><code>com.yatl</code></li> <li><code>com.yatl.controller</code></li> <li><code>com.yatl.dao</code></li> <li><code>com.yatl.model</code></li> <li><code>com.yatl.util</code></li></ul> <p>When done, your <code>src/test/java</code> directory should look like this:</p> <p><img src="/com-1028-labs/assets/img/packages.e798c96e.png" alt="Test Directory"></p> <ol start="2"><li>Eclipse sometimes hides empty packages. The best way to avoid this is to click on the three dots in the top right of the package explorer and select <code>Filters and Customization</code>. Then uncheck <code>Empty Packages</code> and click <code>OK</code>.</li></ol> <h2 id="exercise-2-testing-the-yatl-application"><a href="#exercise-2-testing-the-yatl-application" class="header-anchor">#</a> Exercise 2: Testing the YATL Application</h2> <p>We are now ready to start writing some tests for our application. In this exercise, we will construct unit and wider reaching integration tests.</p> <h3 id="exercise-2-1-testing-the-todo-model"><a href="#exercise-2-1-testing-the-todo-model" class="header-anchor">#</a> Exercise 2.1: Testing the <code>Todo</code> Model</h3> <p>Let's consider how we might test <code>src/main/java/com/yatl/model/Todo.java</code>. This class is simply a POJO (Plain Old Java Object) that represents a TODO in our application. Some people make the argument that we don't need to test POJOs (I tend to agree with this); however, let's take the purist approach and write a test for it anyway. Since we are isolating a single object, this can be considered a unit test.</p> <ol><li>Create a new class called <code>TodoTest</code> in the <code>com.yatl.model</code> test package. Add the following skeleton code to the class:</li></ol> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yatl<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token static">assertEquals</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">BeforeEach</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TodoTest</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">Todo</span> todo<span class="token punctuation">;</span>

	<span class="token comment">// this method is called before each test</span>
	<span class="token comment">// giving us a fresh todo object to work with</span>
	<span class="token annotation punctuation">@BeforeEach</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Create a new todo object</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTodoCreated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Use the getters to assert the todo object was created with the expected values</span>
		<span class="token comment">// test each of the getters return the values in the todo object created in the</span>
		<span class="token comment">// setUp method</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTodoSetters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Use the setter to update the todo object and then use the getter to assert</span>
		<span class="token comment">// the todo object was updated with the expected values</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>Complete the above test class, and then run the tests. To run the tests, right click on the <code>TodoTest</code> class and select <code>Run As -&gt; JUnit Test</code>. You should see the tests pass.</li></ol> <p><a href="https://gitlab.surrey.ac.uk/com_1028_labs/lab-6/-/blob/exercise-2-1-solution/src/test/java/com/yatl/model/TodoTest.java?ref_type=heads" target="_blank" rel="noopener noreferrer">If you got stuck, check your <code>TodoTest</code> class against the solutions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="exercise-2-2-testing-the-tododao-with-an-in-memory-database"><a href="#exercise-2-2-testing-the-tododao-with-an-in-memory-database" class="header-anchor">#</a> Exercise 2.2: Testing the TodoDao with an in-memory database</h3> <p>Let's consider how we might test <code>src/main/java/com/yatl/dao/TodoDao.java</code>. This class is responsible for interacting with the database. As such, it becomes interesting to test. We have two options here:</p> <ol><li>We could test the class using and in-memory database.</li> <li>We could mock the database.</li></ol> <p>In this case, I prefer the first option. Where possible, I would rather use a real database to test. Mocking can be tricky, especially when we are testing SQL statements. Moreover, If we were to mock our database, all we could really test is methods are called with the correct SQL statements. We wouldn't be able to test the SQL statements return the correct data.</p> <ol><li>The first thing we need to do is create a new database for our tests. Create a <code>TestSeeder</code> class in the <code>com.yatl.util</code> package (ensure it's in your test folder). <a href="https://gitlab.surrey.ac.uk/com_1028_labs/lab-6/-/blob/exercise-2-2-solutions/src/test/java/com/yatl/util/TestSeeder.java?ref_type=heads" target="_blank" rel="noopener noreferrer">Next, copy and past the code from from my solution into your <code>Seeder</code> class.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <p>You should notice the test Seeder class is similar to the Seeder class in the <code>src/main/java/com/yatl/util</code> package. The only major difference is we are returning the connection. We do this, as the database will be created in memory and we can't access it via a path. As such, we need to be able to pass the connection around.</p> <ol><li>The next thing we need to do is update <code>src/main/java/com/yatl/util/Database.java</code> to allow us to pass a connection to the Database object. This is simple, we just need to overload the constructor and <code>getInstance</code> methods. We can do this by adding the following code to the <code>Database</code> class:</li></ol> <div class="language-java extra-class"><pre class="language-java"><code>
   <span class="token keyword">private</span> <span class="token class-name">Database</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> connection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   	<span class="token keyword">this</span><span class="token punctuation">.</span>connection <span class="token operator">=</span> connection<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Database</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Database</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> instance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>We are now ready to test the <code>TodoDao</code> class.</p> <ol start="2"><li><p>In <code>src/test/java/com/yatl/dao</code> create a class called <code>TodoDaoTest</code>.</p></li> <li><p>The first thing you need to do is create a <code>@BeforeEach</code> method that will run the seeder for each test. You can do this by adding the following code to the <code>TodoDaoTest</code> class:</p></li></ol> <div class="language-java extra-class"><pre class="language-java"><code>
   	<span class="token class-name">TodoDao</span> todoDAO<span class="token punctuation">;</span>
	<span class="token annotation punctuation">@BeforeEach</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">&quot;jdbc:sqlite::memory:&quot;</span><span class="token punctuation">;</span>
		<span class="token class-name">TestSeeder</span> seeder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestSeeder</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
		seeder<span class="token punctuation">.</span><span class="token function">createTables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Database</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>seeder<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		todoDAO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TodoDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

</code></pre></div><blockquote><blockquote><p>Ensure you add the correct imports to the top of the class. You can do this by pressing <code>Ctrl + Shift + O</code> in Eclipse.</p></blockquote></blockquote> <p>Above, we are using the test seeder to create a new database in memory. We then pass the connection to the <code>Database</code> class. As the Database class is a singleton, the entire application will use our in-memory database. The final thing we do is create a new <code>TodoDao</code> object, this is what we will be testing.</p> <ol start="4"><li>See if you can write the following tests methods:</li></ol> <ul><li><p><code>testGetAllTodos</code> - This method should test the <code>getAllTodos</code> method. You should assert that the list of todos returned is the correct length (4). Don't test the values of each todo, this is overkill. Later we will run integration tests to test the values of the todos.</p></li> <li><p><code>testById</code> - This method should test the <code>getTodo</code> method. You should assert that the todo returned is the correct todo by checking the title. As this point you can test the title of the todo (e.g., Learn Java). Since it's unique, it's a good test.</p></li> <li><p><code>testGetByStatus</code> - This method should test the <code>getByStatus</code> method. For getByStatus(true) the length of the list should be 1 (the number for completed todos). For getByStatus(false) 3, the number of active todos.</p></li></ul> <p><strong>HINT:</strong> Here's an example of how you might test the <code>getAllTodos</code> method:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetAllTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Todo</span><span class="token punctuation">&gt;</span></span> todos<span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			todos <span class="token operator">=</span> todoDAO<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> todos<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;SQL Exception&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://gitlab.surrey.ac.uk/com_1028_labs/lab-6/-/blob/exercise-2-2-solutions/src/test/java/com/yatl/dao/TodoDaoTest.java?ref_type=heads" target="_blank" rel="noopener noreferrer">If you got stuck, check the solutions here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="exercise-2-3-testing-the-controller-class"><a href="#exercise-2-3-testing-the-controller-class" class="header-anchor">#</a> Exercise 2.3: Testing the Controller Class</h3> <p>Controllers are the glue between our data layer and the view. In our case the view is the API. To trigger the API we'd need to send an HTTP request. However, we don't want to do this, right now. We want to test the controller in isolation. As such, we need to mock the HTTP request. We can do this using the <code>Mockito</code> library.</p> <p>Furthermore, you'll notice we pass a <code>TodoDao</code> object to the <code>TodoController</code> class. Again, we don't want to test the <code>TodoDao</code> class, we want to test the <code>TodoController</code> class. As such, we also need to mock the <code>TodoDao</code>.</p> <ol><li>Create a new class called <code>TodoControllerTest</code> in the <code>com.yatl.controller</code> test package.</li></ol> <p>Let's, first, consider how we might test the <code>getAllTodos</code> method on the TodoController. This method is responsible for returning all the todos. It has the following requirements:</p> <ul><li>If the status is null, the <code>getAll</code> method on the DAO is called.</li> <li>If the status is &quot;completed&quot;, the <code>getByStatus</code> method on the Dao is called with the parameter <code>true</code>.</li> <li>If the status is &quot;active&quot;, the <code>getByStatus</code> method on the Dao is called with the parameter <code>false</code>.</li> <li>If an exception is thrown, the HTTP status is set to 500.</li></ul> <p>Let's test the first three points.</p> <ol start="2"><li>Set up your mocks before each test. You can do this by adding the following code to the <code>TodoControllerTest</code> class:</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yatl<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Mockito</span><span class="token punctuation">.</span><span class="token static">mock</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">BeforeEach</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yatl<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">TodoDao</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>javalin<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TodoControllerTest</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token class-name">Context</span> ctx<span class="token punctuation">;</span>
   <span class="token keyword">private</span>  <span class="token class-name">TodoDao</span> todoDao<span class="token punctuation">;</span>
   <span class="token keyword">private</span>  <span class="token class-name">TodoController</span> todoController<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@BeforeEach</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   	ctx <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   	todoDao <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">TodoDao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   	todoController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TodoController</span><span class="token punctuation">(</span>todoDao<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>Now, create your test:</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetAllTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		todoController<span class="token punctuation">.</span><span class="token function">getAllTodos</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token function">verify</span><span class="token punctuation">(</span>todoDao<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>
</code></pre></div><blockquote><blockquote><p>Ensure you add the correct imports to the top of the class. You can do this by pressing <code>Ctrl + Shift + O</code> in Eclipse.</p></blockquote></blockquote> <p>Above, we are testing when the <code>getAllMethod</code> is called, the default behavior it to call the <code>getAll</code> method on the <code>TodoDao</code> object. Run the test.</p> <p><strong>ALERT:</strong> Notice how our test failed with the following message:</p> <div class="language- extra-class"><pre class="language-text"><code>Wanted 1 time:
-&gt; at com.yatl.dao.TodoDao.getAll(TodoDao.java:25)
But was 2 times:
</code></pre></div><p>We are calling getAll todos in error at the start of the controller, <code>getAllTodos</code>, method. We should change this line to <code>List&lt;Todo&gt; todos = null</code>. When you have done this, run the test again. It should pass. This was actually a mistake I made; however, I only spotted it when I ran the test.</p> <p>Let's now consider how we can test the second two points, get by completed and active todos. To achieve this, we need to stub the return value of the <code>queryParam</code> method. We can do this using this technique: <code>when(ctx.queryParam(&quot;status&quot;)).thenReturn(&quot;completed&quot;);</code></p> <ol start="3"><li>Add the following test to the <code>TodoControllerTest</code> class:</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetTodosByStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token function">when</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">queryParam</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">&quot;completed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			todoController<span class="token punctuation">.</span><span class="token function">getAllTodos</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">verify</span><span class="token punctuation">(</span>todoDao<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getByStatus</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">when</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">queryParam</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token string">&quot;active&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			todoController<span class="token punctuation">.</span><span class="token function">getAllTodos</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">verify</span><span class="token punctuation">(</span>todoDao<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getByStatus</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// TODO Auto-generated catch block</span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

</code></pre></div><blockquote><blockquote><p>Ensure you add the correct imports to the top of the class. You can do this by pressing <code>Ctrl + Shift + O</code> in Eclipse.</p></blockquote></blockquote> <p>Above, we are testing that when the status is &quot;completed&quot; the <code>getByStatus</code> method is called with the parameter <code>true</code>. When the status is &quot;active&quot; the <code>getByStatus</code> method is called with the parameter <code>false</code>.</p> <ol start="4"><li>Now it's your turn! Complete this task by adding the following tests:</li></ol> <ul><li><p><code>public void testThrows500WhenGetAllDatabaseError()</code> - this tests the final point, if an exception is thrown, the status is set to 500. You can stub the <code>getAll</code> method to throw an exception like this: <code>when(todoDao.getAll()).thenThrow(new SQLException());</code> You can then check the status code like this: <code>verify(ctx).status(500);</code>.</p></li> <li><p><code>public void testGetTodoById()</code> - to create this test stub the value returned from the path param method. You can do this like this: <code>when(ctx.pathParam(&quot;id&quot;)).thenReturn(&quot;1&quot;);</code>. You should check that the <code>getTodo</code> method is called with the parameter 1.</p></li> <li><p><code>public void testThrows500WhenGetByIdDatabaseError()</code> - similar to the exception test above.</p></li> <li><p><code>public void testThrows404WhenTodoNotFound</code> - check that the status is set to 404 when the todo is not found. You can do this by stubbing the <code>getTodo</code> method to return null.</p></li></ul> <p><a href="https://gitlab.surrey.ac.uk/com_1028_labs/lab-6/-/blob/exercise-2-3-solutions/src/test/java/com/yatl/controller/TodoControllerTest.java?ref_type=heads" target="_blank" rel="noopener noreferrer">If you got stuck, check the solutions here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>`</p> <h3 id="exercise-2-4-pulling-everything-together-with-integration-tests"><a href="#exercise-2-4-pulling-everything-together-with-integration-tests" class="header-anchor">#</a> Exercise 2.4: Pulling everything together with integration tests</h3> <p>We are now ready to pull everything together with integrations tests. These could also be called system tests. We are going to test the entire application, from the controller to the database. We will use the <code>RestAssured</code> library to do this.</p> <p>As integration tests cover the entire application, we are going to create them all in one file that lives in the <code>com.yatl</code> test package.</p> <ol><li>Create a new class called <code>IntegrationTests</code> in the <code>com.yatl</code> test package.</li></ol> <p>The first thing we need to do is create a test version of our application and seed our in-memory database, just like we did when testing the DAO.</p> <ol start="2"><li>At the top of the class, add the following code:</li></ol> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yatl</span><span class="token punctuation">;</span>

<span class="token comment">// rest assured imports; we will use these to test our API</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">io<span class="token punctuation">.</span>restassured<span class="token punctuation">.</span></span><span class="token class-name">RestAssured</span><span class="token punctuation">.</span><span class="token static">given</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>hamcrest<span class="token punctuation">.</span></span><span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token static">equalTo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>hamcrest<span class="token punctuation">.</span></span><span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token static">hasItems</span></span><span class="token punctuation">;</span>


<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">AfterEach</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">BeforeEach</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yatl<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Database</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yatl<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">TestSeeder</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>javalin<span class="token punctuation">.</span></span><span class="token class-name">Javalin</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">IntegrationTests</span> <span class="token punctuation">{</span>

	<span class="token class-name">Javalin</span> app<span class="token punctuation">;</span>
	<span class="token class-name">TestSeeder</span> seeder<span class="token punctuation">;</span>

	<span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">6000</span><span class="token punctuation">;</span>

	<span class="token class-name">String</span> baseUrl <span class="token operator">=</span> <span class="token string">&quot;http://localhost:&quot;</span> <span class="token operator">+</span> port<span class="token punctuation">;</span>


	<span class="token annotation punctuation">@BeforeEach</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">&quot;jdbc:sqlite::memory:&quot;</span><span class="token punctuation">;</span>
		seeder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestSeeder</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
		seeder<span class="token punctuation">.</span><span class="token function">createTables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Database</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>seeder<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		app <span class="token operator">=</span> <span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token function">startServer</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@AfterEach</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		app<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Above, we are creating a new <code>TestSeeder</code> object and creating a new database in-memory. We then pass the connection to the <code>Database</code> class. We then start the server on port 6000. We are using the <code>AppConfig</code> class to start the server. This is a class that lives in the <code>com.yatl</code> package of our application.</p> <p>We can now use the <code>RestAssured</code> library to test our API. This library allows us to send HTTP requests to our API and assert the response. For instance, we can write a test like this:</p> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetAllTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">given</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>baseUrl <span class="token operator">+</span> <span class="token string">&quot;/todos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

</code></pre></div><p>Above, we are sending a <code>GET</code> request to the <code>/todos</code> endpoint and asserting that the status code is 200. This is a simple test, but it's a good start. We can also take things further and inspect the the records in the response.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetAllTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token function">given</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>baseUrl <span class="token operator">+</span> <span class="token string">&quot;/todos&quot;</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token function">hasItems</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token function">hasItems</span><span class="token punctuation">(</span><span class="token string">&quot;Learn Java&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Vote for Joe&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Buy a car&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Ace Joes Module&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre></div><p>The above code tests if the expected todos' id and titles are returned in a JSON list - pretty awesome, and close to how a real client application would interact with the API. If the response is not as expected, the test will fail.</p> <p>We can also test if we can retrieve a single todo:</p> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetTodoById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">given</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>baseUrl <span class="token operator">+</span> <span class="token string">&quot;/todos/1&quot;</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token string">&quot;Learn Java&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

</code></pre></div><p>Notice how we are using the <code>equalTo</code> method to test the values of the movie, this is because it is a single item. It will look like this:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Learn Java&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;completed&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li><a href="https://github.com/rest-assured/rest-assured/wiki/Usage#example-1---json" target="_blank" rel="noopener noreferrer">Can you use the Rest Assured documentation, and my example above, to write tests for the following requirements<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</li></ol> <ul><li>When I send a GET request to /todos, I should receive a list of todos.</li> <li>When I send a GET request to /todos/1, I should receive the todo with the id of 1.</li> <li>When I send a GET request to /todos?status=completed, I should receive a list of completed todos.</li> <li>When I send a GET request to /todos?status=active, I should receive a list of active todos.</li> <li>When I send a request with an invalid id, I should receive a 404 status code.</li></ul> <p>To get the above tests to work, you'll need to ensure the following imports are at the top of the <code>IntegrationTests</code> class:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">io<span class="token punctuation">.</span>restassured<span class="token punctuation">.</span></span><span class="token class-name">RestAssured</span><span class="token punctuation">.</span><span class="token static">given</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>hamcrest<span class="token punctuation">.</span></span><span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token static">equalTo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>hamcrest<span class="token punctuation">.</span></span><span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token static">hasItems</span></span><span class="token punctuation">;</span>
</code></pre></div><p><a href="https://gitlab.surrey.ac.uk/com_1028_labs/lab-6/-/blob/exercise-2-4-solutions/src/test/java/com/yatl/IntegrationTests.java?ref_type=heads" target="_blank" rel="noopener noreferrer">If you got stuck, check the solutions here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>END OF LAB </strong></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/com-1028-labs/assets/js/app.13e044df.js" defer></script><script src="/com-1028-labs/assets/js/2.b1f9b7d9.js" defer></script><script src="/com-1028-labs/assets/js/1.044c1f98.js" defer></script><script src="/com-1028-labs/assets/js/17.bebc8070.js" defer></script>
  </body>
</html>
